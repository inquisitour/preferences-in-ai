# Code Documentation

This document explains the main modules and their responsibilities.

---

## `core/`

- **`types.py`**
  - `MultiIssueElection`: stores approval preferences as a NumPy array  
    (shape: n_voters × n_issues × n_candidates).
  - `Outcome`: winners per issue.
  - Welfare functions:
    - `utilitarian_welfare`
    - `egalitarian_welfare`
    - `nash_welfare`

---

## `statistical_cultures/`

Preference generators used to create synthetic elections:

- **`p_ic.py`**
  - `PICConfig`: config for per-issue impartial culture (p-IC).
  - `sample_p_ic`: generates elections under p-IC.

- **`disjoint.py`**
  - `DisjointConfig`: voters partitioned into `n_groups` with internally aligned preferences.
  - `sample_disjoint`: generates elections from the disjoint model.

- **`resampling.py`**
  - `ResamplingConfig`: $(p, \phi)$ resampling with correlation across issues.
  - `sample_resampling`: generates elections from the resampling model.

- **`hamming_noise.py`**
  - `HammingConfig`: wraps a base culture (`p_ic`, `resampling`, or `disjoint`) and adds noise.
  - `sample_hamming`: samples from the base culture and flips approvals with probability `noise`.

---

## `voting_rules/`

- **`utilitarian.py`** – Sequential utilitarian rule.
- **`sequential_thiele.py`** – Generic sequential Thiele; implements PAV (harmonic) and CC.
- **`owa.py`** – OWA-based rules (Leximin, Mean).

All rules return an `Outcome` (list of winners per issue).

---

## `free_riding/`

- **`detector.py`**
  - `detect_free_riding(elec, rule)`: simulates manipulations by flipping a voter’s approvals and checks if the election outcome changes in favor of the manipulator.

- **`risk.py`**
  - `evaluate_risk(elec, rule)`: wraps detector results into summary statistics (trials, successes, harms, success rate, harm rate).

- **`welfare.py`**
  - `welfare_summary(elec, outcome)`: computes utilitarian, egalitarian, and Nash welfare from an `Outcome`.

---

## `experiments/`

- **`run_experiments.py`**
  - Batch runner across cultures × rules × seeds.  
  - Saves combined results to CSV and LaTeX tables.

- **`plot_results.py`**
  - Produces welfare and risk bar charts per culture and overview plots.

---

## `report/`

- **`report.tex`** – Main LaTeX report.
- **`tables/combined.tex`** – Auto-generated LaTeX table.
- **`figures/`** – Plots generated by `plot_results.py`.

---

## `tests/`

Pytest suite for cultures, rules, free-riding detection, and risk aggregation.

Run with:
```bash
python -m pytest tests/
```
